services:
  # Backend API
  api-backend:
    build:
      context: ./api-backend
      dockerfile: Dockerfile
      args:
      - NEXT_PUBLIC_SUPABASE_URL=https://zckxtpvggtojwrpdjage.supabase.co
      - NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inpja3h0cHZnZ3RvandycGRqYWdlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4NjMyNTAsImV4cCI6MjA4MTQzOTI1MH0.Y1nqQDoo_Qx0ZAAWfViJD3KDWTlPE1Gv7sLdDLaio5Q
      - SUPABASE_SERVICE_ROLE_KEY=${SUPABASE_SERVICE_ROLE_KEY}
      - NEXTAUTH_SECRET=b5a17ad16cec8dc05e4ba5f3a61f54e2083787a1d980696981769fb635ef18c9
      - NEXTAUTH_URL=http://194.195.211.111
      - NEXT_PUBLIC_FRONTEND_URL=http://194.195.211.111
      - MAILJET_API_KEY=${MAILJET_API_KEY}
      - MAILJET_SECRET_KEY=${MAILJET_SECRET_KEY}
      - MAIL_FROM_EMAIL=${MAIL_FROM_EMAIL}
      - MAIL_FROM_NAME=${MAIL_FROM_NAME}
    environment:
      - NODE_ENV=production
      - PORT=3000
      - NEXT_PUBLIC_SUPABASE_URL=https://zckxtpvggtojwrpdjage.supabase.co
      - NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inpja3h0cHZnZ3RvandycGRqYWdlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4NjMyNTAsImV4cCI6MjA4MTQzOTI1MH0.Y1nqQDoo_Qx0ZAAWfViJD3KDWTlPE1Gv7sLdDLaio5Q
      - SUPABASE_SERVICE_ROLE_KEY=${SUPABASE_SERVICE_ROLE_KEY}
      - NEXTAUTH_SECRET=b5a17ad16cec8dc05e4ba5f3a61f54e2083787a1d980696981769fb635ef18c9
      - NEXTAUTH_URL=http://194.195.211.111
      - NEXT_PUBLIC_FRONTEND_URL=http://194.195.211.111
      - MAILJET_API_KEY=${MAILJET_API_KEY}
      - MAILJET_SECRET_KEY=${MAILJET_SECRET_KEY}
      - MAIL_FROM_EMAIL=${MAIL_FROM_EMAIL}
      - MAIL_FROM_NAME=${MAIL_FROM_NAME}
    expose:
      - "3000"
    networks:
      - app-network
    restart: unless-stopped

  # Frontend
  web-frontend:
    build:
      context: ./web-frontend
      dockerfile: Dockerfile
      args:
        - NEXT_PUBLIC_API_URL=/api
        - NEXT_PUBLIC_SUPABASE_URL=https://zckxtpvggtojwrpdjage.supabase.co
        - NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inpja3h0cHZnZ3RvandycGRqYWdlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4NjMyNTAsImV4cCI6MjA4MTQzOTI1MH0.Y1nqQDoo_Qx0ZAAWfViJD3KDWTlPE1Gv7sLdDLaio5Q
    environment:
      - NODE_ENV=production
      - PORT=3001
      - NEXT_PUBLIC_API_URL=/api
      - INTERNAL_API_URL=http://api-backend:3000/api
      - NEXT_PUBLIC_SUPABASE_URL=https://zckxtpvggtojwrpdjage.supabase.co
      - NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inpja3h0cHZnZ3RvandycGRqYWdlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4NjMyNTAsImV4cCI6MjA4MTQzOTI1MH0.Y1nqQDoo_Qx0ZAAWfViJD3KDWTlPE1Gv7sLdDLaio5Q
      - SUPABASE_SERVICE_ROLE_KEY=${SUPABASE_SERVICE_ROLE_KEY}
      - NEXTAUTH_URL=http://194.195.211.111
      - NEXTAUTH_SECRET=b5a17ad16cec8dc05e4ba5f3a61f54e2083787a1d980696981769fb635ef18c9
    expose:
      - "3001"
    networks:
      - app-network
    restart: unless-stopped
    depends_on:
      - api-backend

  # Nginx Reverse Proxy
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
    volumes:
      - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro
    networks:
      - app-network
    restart: unless-stopped
    depends_on:
      - web-frontend
      - api-backend

networks:
  app-network:
    driver: bridge
